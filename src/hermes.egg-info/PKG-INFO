Metadata-Version: 2.4
Name: hermes
Version: 0.0.1
Summary: Hermes AI Logistics Assistant â€” natural language analytics for shipments (PandasAI powered)
Author-email: Hermes AI <dev@hermes.ai>
License: MIT
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Python: <3.12,>=3.8
Description-Content-Type: text/markdown
Requires-Dist: pandasai>=3.0.0b19
Requires-Dist: pandasai-litellm>=0.0.1
Requires-Dist: gradio>=5.48.0
Requires-Dist: pillow>=9.0.0
Requires-Dist: watchgod
Provides-Extra: dev
Requires-Dist: pytest>=7.0; extra == "dev"
Requires-Dist: pytest-cov; extra == "dev"
Requires-Dist: flake8; extra == "dev"
Requires-Dist: pre-commit; extra == "dev"

# ğŸš€ Hermes â€” Intelligent Logistics Analytics Assistant

An LLM-driven conversational analytics platform for shipment data analysis, built with PandasAI, Gradio 5.48.0, and local LLM integration.

---

## ğŸ“‹ Table of Contents

1. [Overview](#overview)
2. [System Architecture](#system-architecture)
3. [Data Structure](#data-structure)
4. [Key Features Implemented](#key-features-implemented)
5. [Query Understanding & Processing](#query-understanding--processing)
6. [Installation & Setup](#installation--setup)
7. [Usage](#usage)
8. [Evaluation Design](#evaluation-design)
9. [File Structure](#file-structure)

---

## Overview

Hermes is a logistics analytics assistant that allows operations managers to:
- Ask natural language questions about shipment data
- Receive AI-driven insights with visualizations
- See the AI's reasoning process for query classification
- Generate predictions and recommendations
- Export chat history for audit trails

**Target Users:** Logistics managers, operations analysts, supply chain coordinators

**Data Source:** CSV files containing shipment records with route, warehouse, date, and delivery metrics

---

## System Architecture

### High-Level Flow

```
User Query
    â†“
[Gradio UI] â† â†’ [HermesApp Orchestrator]
    â†“                        â†“
Chat Interface      [QueryRouter] (Intent Classification)
  - Messages              â†“
  - Agent Reasoning   Intent Detection
  - Charts            (visualization/prediction/stats/general)
                           â†“
                    [Dispatch to Handler]
                           â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                    â†“                    â†“
   [PandasAI]         [HermesAnalytics]    [HermesVisualizer]
   SmartDataframe      (Predictions)        (Chart Generation)
        â†“                    â†“                    â†“
   LLM Response      ML Model Output       PNG Chart File
        â†“                    â†“                    â†“
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    [Format Response]
                             â†“
                  Return to Gradio UI
```

### Component Responsibilities

| Component | File | Responsibility |
|-----------|------|-----------------|
| **UI/Chat Interface** | `src/hermes/ui_agent.py` | Gradio 5.48.0 chat UI, agent reasoning display, data loading integration |
| **Orchestrator** | `src/hermes/app.py` | Main app logic, query routing, handler dispatch |
| **Router** | `src/hermes/router.py` | Intent classification, query pattern matching |
| **Analytics** | `src/hermes/analytics.py` | Statistics, predictions, recommendations |
| **Visualizer** | `src/hermes/visualizer.py` | Chart generation with cache-busting |
| **Config** | `src/hermes/config.py` | LLM setup, PandasAI settings, paths |
| **Models** | `src/hermes/models.py` | Pydantic response type definitions |

---

## Data Structure

### Input: Shipments CSV

Expected columns:
```
date               â†’ Date of shipment (ISO format)
route              â†’ Route identifier (e.g., "Route_A")
warehouse          â†’ Warehouse code (e.g., "WH_01")
delay_minutes      â†’ Actual delay in minutes
on_time            â†’ Boolean: True if on-time, False if delayed
shipment_id        â†’ Unique shipment identifier
distance_km        â†’ Shipment distance
carrier            â†’ Carrier name
```

### Sample Data
Located in `data/shipments.csv` (1000+ records for testing)

```
date,route,warehouse,delay_minutes,on_time,shipment_id,distance_km,carrier
2025-01-01,Route_A,WH_01,5,True,S001,250,CarrierX
2025-01-01,Route_B,WH_02,-10,True,S002,180,CarrierY
...
```

---

## Key Features Implemented

### âœ… 1. Conversational Chat Interface
- **File:** `src/hermes/ui_agent.py`
- **Status:** Complete
- **Features:**
  - Gradio 5.48.0 chat with `type='messages'` format
  - Agent reasoning display in sidebar
  - Integrated data loading (no separate button)
  - Avatar images for user/bot
  - Suggestion buttons for common queries

### âœ… 2. Query Intent Classification
- **File:** `src/hermes/router.py`
- **Status:** Complete
- **Method:** LLM-based classification (JSON extraction)
- **Supported Intents:**
  - `visualization` â†’ Generate charts
  - `prediction` â†’ Forecast delays
  - `recommendation` â†’ Improvement suggestions
  - `statistics` â†’ Summary statistics
  - `general` â†’ Open-ended queries

### âœ… 3. Agent Reasoning Display
- **File:** `src/hermes/ui_agent.py` (HermesAgentTools class)
- **Status:** Complete
- **Shows:**
  - Classification step with confidence scores
  - Query analysis results
  - Chain of reasoning before final answer

### âœ… 4. Chart Generation with Cache-Busting
- **File:** `src/hermes/visualizer.py`
- **Status:** Complete
- **Features:**
  - Fresh chart generation per query
  - Old chart cleanup (keeps last 5)
  - Prevents chart reuse across queries
  - Config: `enable_cache=False` in `config.py`

### âœ… 5. Data Loading Integration
- **File:** `src/hermes/ui_agent.py`
- **Status:** Complete
- **Behavior:**
  - Data selector dropdown in query box
  - Auto-loads on first query if not loaded
  - Shows loading status in chat messages
  - Supports multiple CSV files

### âœ… 6. Error Handling & Type Safety
- **Files:** `src/hermes/models.py`, `src/hermes/app.py`
- **Status:** Complete
- **Implementation:**
  - Pydantic response types (BaseResponse subclasses)
  - Proper error responses with `success` field
  - Type validation for all responses
  - Graceful fallbacks

---

## Query Understanding & Processing

### Query Classification Process

```
User Input: "Show me delayed shipments by route"
    â†“
[Router.classify_query()]
    â”œâ”€ Sends to LLM: Classification prompt
    â”œâ”€ Expected output: {"intent": "visualization", "confidence": 0.92}
    â””â”€ Parsed by QueryRouter
    â†“
Intent: visualization (92% confidence)
    â†“
[Dispatch to _handle_visualization_chat()]
    â”œâ”€ Calls SmartDataframe.chat() with visualization request
    â”œâ”€ PandasAI generates chart via LLM
    â”œâ”€ Saves PNG to CHARTS_DIR
    â”œâ”€ Returns chart path + response text
    â†“
Format Response
    â”œâ”€ Extract chart file path
    â”œâ”€ Add to ChatMessage
    â”œâ”€ Include reasoning chain
    â†“
Display in Gradio Chat
```

### Handler Types

| Intent | Handler | Output |
|--------|---------|--------|
| `visualization` | `_handle_visualization_chat()` | Markdown + Chart |
| `prediction` | `_handle_prediction_chat()` | ML forecast results |
| `recommendation` | `_handle_recommendation_chat()` | Improvement suggestions |
| `statistics` | `_handle_stats_chat()` | Summary statistics |
| `general` | `_handle_general_chat()` | Open query response |

### Example Query & Output

**Query:** "What percentage of shipments were delayed?"

**Classification:**
```
Intent: statistics
Confidence: 0.89
```

**Processing:**
1. Classify as statistics intent
2. Extract date context from DataFrame
3. Call `HermesAnalytics.get_summary_stats()`
4. Format results with markdown

**Output:**
```markdown
ğŸ“Š **Statistics Summary**

- Total Shipments: 1000
- Delayed Shipments: 234
- On-Time %: 76.6%
- Average Delay: 18.5 minutes
- Median Delay: 12 minutes
```

---

## Installation & Setup

### Prerequisites
- Python 3.11+
- Conda or venv
- Local LLM endpoint (Qwen, Llama, etc.) on `http://localhost:8001/v1`

### Installation

```bash
# Clone repository
git clone https://github.com/phitrann/Hermes.git
cd Hermes

# Create environment
python -m venv .venv
source .venv/bin/activate  # Linux/macOS
# or .venv\Scripts\activate on Windows

# Install package (editable mode)
pip install -e .

# Install dev dependencies (optional)
pip install watchgod  # For auto-reload
```

### Environment Configuration

Create `.env` file (optional):
```bash
LLM_ENDPOINT=http://localhost:8001/v1
LLM_MODEL=qwen-7b  # or your model name
LLM_API_KEY=not-needed
```

### LLM Setup

Make sure your LLM endpoint is running:
```bash
# Example: Run Ollama
ollama serve

# Example: Run other LLM server
python -m your_llm_server --port 8001
```

---

## Usage

### Running the App

**Option 1: Console script (recommended)**
```bash
hermes-ai
```

**Option 2: Python module**
```bash
python -m hermes.app
```

**Option 3: Dev mode with auto-reload**
```bash
python dev.py
```

### Using the Interface

1. **Open browser:** `http://localhost:7860`

2. **Select/Load Data:**
   - Dropdown appears in query box (labeled "Select a data file")
   - Choose from available CSV files in `data/` directory
   - Data loads automatically on first query

3. **Ask Questions:**
   - Type natural language question
   - Click Send or press Enter
   - Watch reasoning chain appear in sidebar
   - Results appear in chat with chart (if applicable)

4. **Example Queries:**
   ```
   "Show me delivery performance by warehouse"
   "Which routes have the most delays?"
   "Predict delays for next week"
   "Give me recommendations to improve on-time delivery"
   "How many shipments were delayed?"
   ```

### Sample Questions File

Pre-loaded sample questions from `data/shipment_questions_500.csv`:
- "How many total shipments are in the data?"
- "Which warehouse has the highest average delay?"
- "What is the on-time delivery rate by route?"
- "Show me the distribution of delays"

---

## Evaluation Design

### 1. Accuracy of Query Results

**Metric:** Response correctness vs. ground truth

**Evaluation Method:**
- Manually verify 10-20 sample queries
- Compare LLM-generated answers against:
  - Direct SQL/pandas results
  - Data summary statistics
  - Known data patterns

**Example Test Case:**
```
Query: "How many shipments are on-time?"
Expected: Count of rows where on_time=True
Verify: LLM result matches pandas df[df['on_time']==True].shape[0]
```

**Success Criteria:** â‰¥90% accuracy on test queries

---

### 2. Explainability (Query Reasoning)

**Metric:** User can understand system decisions

**Evaluation Method:**
- Verify reasoning chain is displayed for each query
- Check that classification intent is shown with confidence
- Ensure data sources are referenced

**What's Shown:**
1. Classification step with confidence score
2. Query analysis results
3. Final answer with statistics

**Success Criteria:** User can trace decision path from query to answer

---

### 3. Response Time

**Metric:** System responsiveness

**Evaluation Method:**
- Measure time from query submission to result display
- Track separately:
  - Data loading time (first query)
  - Classification time
  - Chart generation time
  - Total response time

**Current Performance (Baseline):**
```
Data Loading:      2-3 seconds (first time only)
Classification:    0.5-1 second
Query Processing:  1-3 seconds (depends on LLM)
Chart Generation:  2-5 seconds (PandasAI)
Total (w/ chart):  4-8 seconds
Total (text only):  2-4 seconds
```

**Success Criteria:** <10 seconds for most queries, <5 seconds for text-only

---

### 4. Chart Accuracy

**Metric:** Charts accurately represent data

**Evaluation Method:**
- Verify chart generation doesn't reuse old charts
- Check chart contents match query intent
- Ensure proper cache-busting

**Test Case:**
```
Query 1: "Show me delays by route" â†’ Chart A generated
Query 2: "Show me on-time by warehouse" â†’ Chart B generated (NOT Chart A)
Verify: Charts/ directory shows both PNG files
Verify: Charts are different content
```

**Success Criteria:** Each visualization query generates unique chart

---

### 5. System Stability

**Metric:** No crashes or unhandled errors

**Evaluation Method:**
- Run 20+ diverse queries
- Monitor for exceptions in console
- Check error responses are properly formatted

**Success Criteria:** All errors handled gracefully with user-friendly messages

---

## File Structure

```
Hermes/
â”œâ”€â”€ README.md                          # This file
â”œâ”€â”€ INTEGRATION_SUMMARY.md             # Integration notes
â”œâ”€â”€ pyproject.toml                     # Project metadata & dependencies
â”œâ”€â”€ dev.py                             # Dev mode auto-reload script
â”‚
â”œâ”€â”€ data/                              # Sample datasets
â”‚   â”œâ”€â”€ shipments.csv                  # Main dataset
â”‚   â”œâ”€â”€ shipments_1000.csv             # Larger dataset
â”‚   â””â”€â”€ shipment_questions_500.csv     # Sample questions
â”‚
â”œâ”€â”€ src/hermes/                        # Main package
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ app.py                         # HermesApp orchestrator
â”‚   â”œâ”€â”€ ui_agent.py                    # Gradio chat interface
â”‚   â”œâ”€â”€ router.py                      # Query intent classification
â”‚   â”œâ”€â”€ analytics.py                   # Analytics & predictions
â”‚   â”œâ”€â”€ visualizer.py                  # Chart generation
â”‚   â”œâ”€â”€ config.py                      # Configuration & LLM setup
â”‚   â”œâ”€â”€ models.py                      # Pydantic response types
â”‚   â”œâ”€â”€ prompts.py                     # LLM prompt templates
â”‚   â”œâ”€â”€ semantic.py                    # Semantic dataset registration
â”‚   â””â”€â”€ utils.py                       # Utility functions
â”‚
â”œâ”€â”€ charts/                            # Generated chart PNGs (auto-created)
â”œâ”€â”€ logs/                              # Application logs (auto-created)
â””â”€â”€ .cache/                            # Cache files (auto-created)
```

---

## Recent Improvements (Completed)

### âœ… Fixed Issues
1. **Chart Caching Bug** - Each query now generates fresh chart (not reused)
2. **Deprecation Warning** - Gradio chatbot now uses `type='messages'` format
3. **PIL Image Error** - Charts now return as file paths, not PIL objects
4. **Data Loading UI** - Integrated into query box (no separate button)
5. **Agent Reasoning** - Visible in sidebar with step-by-step thinking
6. **Type Safety** - All responses validated with Pydantic models
7. **Error Handling** - Graceful fallbacks for all error cases

### ğŸ”„ Configuration Changes
- `config.py`: Set `enable_cache=False` to force chart regeneration
- `visualizer.py`: Added `clear_cache_for_query()` method
- `ui_agent.py`: Integrated data loading into query flow
- `app.py`: Fixed intent error validation

---

## Known Limitations

1. **LLM Dependency** - Requires external LLM endpoint (local or remote)
2. **Chart Types** - Limited to charts PandasAI can generate
3. **Data Size** - Performance may degrade with >100k rows
4. **Concurrency** - Currently single-user (Gradio default)

---

## Next Steps / Future Improvements

1. **Multi-user support** - Deploy with Gradio Enterprise or FastAPI
2. **Custom chart types** - Add Plotly/Matplotlib integration
3. **Performance optimization** - Add database querying layer
4. **Advanced analytics** - ML model integration, time series forecasting
5. **Export formats** - PDF reports, Excel summaries

---

## Support & Troubleshooting

### LLM Endpoint Not Reachable
```bash
# Check if endpoint is running
curl http://localhost:8001/v1/models

# If not, start your LLM server
ollama serve  # or your LLM server command
```

### Charts Not Displaying
```bash
# Check charts directory
ls -lh charts/

# Verify PandasAI configuration in config.py
# Ensure enable_cache=False
```

### Slow Response Time
- Check LLM endpoint is responsive: `curl http://localhost:8001/v1/models`
- Monitor system resources (CPU/RAM)
- Check logs: `tail -f logs/hermes.log`

---

## License & Attribution

- **Hermes** - Custom implementation
- **PandasAI** - Data analysis with LLM
- **Gradio** - UI framework
- **LiteLLM** - LLM provider abstraction

---

**Last Updated:** November 7, 2025  
**Version:** 0.2.0 (Agent Reasoning & Cache-Busting Release)
